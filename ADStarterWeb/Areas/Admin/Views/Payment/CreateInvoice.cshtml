@{
    ViewData["Title"] = "Billing - Create Invoice";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .BorderLess {
        border: none;
    }
    .delete-row-btn {
        color: red;
        cursor: pointer;
    }
    .table-dashed {
        border: 1px dashed #dee2e6;
    }
    .table-dashed th,
    .table-dashed td {
        border: 1px dashed #dee2e6;
    }
</style>
<div class="page-body">
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-6">
                    <h3>Create Invoice</h3>
                </div>
                <div class="col-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a asp-controller="Dashboard" asp-action="Index">
                                <svg class="stroke-icon">
                                    <use href="../assets/svg/icon-sprite.svg#stroke-home"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="breadcrumb-item">Billing</li>
                        <li class="breadcrumb-item active">Create Invoice</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="card">
            <div class="card-header">
                Invoice
                <strong id="invoiceDate"></strong>
                <span class="float-right"><strong>Status:</strong> <span id="invoiceStatus"></span></span>
            </div>
            <div class="card-body">
                <form id="invoiceForm">
                    <div class="row mb-4">
                        <div class="col-sm-6">
                            <div style="margin-bottom: 8px;">
                                <strong>ADventure Rehabilitation Center</strong>
                            </div>
                            <div style="margin-bottom: 8px;">MA1, Kolej Tun Dr Ismail</div>
                            <div style="margin-bottom: 8px;">Skudai, 80990 Johor Bahru, Johor</div>
                            <div style="margin-bottom: 8px;">Email: info@ADventure.com.my</div>
                            <div style="margin-bottom: 8px;">Phone: +60 123 456 789</div>
                        </div>
                        <div class="col-sm-6">
                            <div class="float-right">
                                <div style="margin-bottom: 8px;">
                                    <input type="text" class="form-control input-primary BorderLess" id="c_myKid" placeholder="Child MYKID">
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <input type="text" class="form-control input-primary BorderLess" id="schedule_ID" placeholder="Schedule ID">
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <input type="date" class="form-control input-primary BorderLess" id="due_date" placeholder="Due Date">
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <input type="number" class="form-control input-primary BorderLess" id="invoice_amount" placeholder="Invoice Amount">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <button type="button" class="btn btn-primary" onclick="createInvoice()">Create Invoice</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            // Set invoice date to today's date
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            $('#invoiceDate').text(formattedDate);

            // Set default status to "Pending"
            $('#invoiceStatus').text('Pending');
        });

        function createInvoice() {
            const invoiceData = {
                c_myKid: $('#c_myKid').val(),
                schedule_ID: $('#schedule_ID').val(),
                due_date: $('#due_date').val(),
                invoice_amount: $('#invoice_amount').val()
            };

            $.ajax({
                url: '@Url.Action("CreateInvoice", "Payment")',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(invoiceData),
                success: function(response) {
                    alert('Invoice created successfully!');
                    // Optionally, redirect to the ManageInvoice page
                    // window.location.href = '@Url.Action("ManageInvoice", "Payment")';
                },
                error: function(xhr, status, error) {
                    console.error("Error creating invoice: " + error);
                    alert('Error creating invoice.');
                }
            });
        }
    </script>
}
